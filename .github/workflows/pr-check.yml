name: PR Quality Check

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  quality-gate:
    name: ðŸš¦ Quality Gate
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ— Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ— Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: ðŸ“¦ Install dependencies
        run: npm ci

      - name: ðŸ” Lint Check
        run: |
          echo "Running ESLint..."
          npm run lint
          if [ $? -ne 0 ]; then
            echo "âŒ ESLint failed! Fix all linting errors before merging."
            exit 1
          fi
          echo "âœ… ESLint passed!"

      - name: ðŸ” Type Check
        run: |
          echo "Running TypeScript type check..."
          npm run type-check
          if [ $? -ne 0 ]; then
            echo "âŒ TypeScript check failed! Fix all type errors before merging."
            exit 1
          fi
          echo "âœ… TypeScript check passed!"

      - name: ðŸ§ª Test Check
        run: |
          echo "Running tests..."
          npm test
          if [ $? -ne 0 ]; then
            echo "âŒ Tests failed! Fix all failing tests before merging."
            exit 1
          fi
          echo "âœ… All tests passed!"

      - name: ðŸ— Build Check
        run: |
          echo "Running production build..."
          npm run build
          if [ $? -ne 0 ]; then
            echo "âŒ Build failed! Fix build errors before merging."
            exit 1
          fi
          echo "âœ… Build succeeded!"

      - name: ðŸ“Š Summary
        if: success()
        run: |
          echo "## âœ… All quality checks passed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ESLint: No errors" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… TypeScript: No type errors" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Tests: All passing" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Build: Successful" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ“Š Failure Summary
        if: failure()
        run: |
          echo "## âŒ Quality checks failed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Please fix all errors before this PR can be merged." >> $GITHUB_STEP_SUMMARY
